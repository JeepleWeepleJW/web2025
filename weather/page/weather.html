<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Homepage</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <script defer src="../js/bootstrap.min.js"></script>
    <script defer>
        let addresses = [];

        document.addEventListener('DOMContentLoaded', () => {
            // JSON 파일 로드
            fetch('../data/weather_keyword.json')
                .then(r => r.json())
                .then(jsonData => addresses = jsonData)
                .catch(err => console.error('JSON 로드 실패:', err));

            const inputEl       = document.getElementById('addressInput');
            const suggestionsEl = document.getElementById('suggestions');
            const formEl        = document.getElementById('searchForm');
            const modalEl       = document.getElementById('resultModal');
            const modalTitle    = modalEl.querySelector('.modal-title');
            const modalBody     = modalEl.querySelector('.modal-body');

            // 입력 이벤트: 자동완성
            inputEl.addEventListener('input', () => {
                const q = inputEl.value.trim();
                suggestionsEl.innerHTML = '';
                if (!q) return;
                addresses
                    .filter(item => item.address.includes(q))
                    .forEach(item => {
                        const btn = document.createElement('button');
                        btn.type = 'button';
                        btn.className = 'list-group-item list-group-item-action';
                        btn.textContent = item.address;
                        btn.onclick = () => {
                            inputEl.value = item.address;
                            suggestionsEl.innerHTML = '';
                        };
                        suggestionsEl.appendChild(btn);
                    });
            });

            // 외부 클릭 시 자동완성 닫기
            document.addEventListener('click', e => {
                if (!inputEl.contains(e.target) && !suggestionsEl.contains(e.target)) {
                    suggestionsEl.innerHTML = '';
                }
            });

            // 검색 제출
            formEl.addEventListener('submit', e => {
                e.preventDefault();
                const val = inputEl.value.trim();
                const found = addresses.find(item => item.address === val);
                if (found) {
                    window.location.href = `weather_info.html?code=${found.administrative_code}`;
                } else {
                    modalTitle.textContent = '검색 오류';
                    modalBody.textContent = '주소를 정확하게 입력해주세요.';
                    new bootstrap.Modal(modalEl).show();
                }
            });
        });
    </script>
    <style>
        .suggestions-container { position: relative; }
        #suggestions {
            position: absolute; top: 100%; left: 0; right: 0;
            z-index: 1000; max-height: 300px; overflow-y: auto;
        }
    </style>
</head>
<body class="bg-white d-flex justify-content-center align-items-center vh-100">
<form id="searchForm" class="w-100" style="max-width:600px;" action="#" method="GET">
    <!-- 오늘 문구: 주소 입력 위에 중앙 정렬 -->
    <div class="row justify-content-center mb-2">
        <div class="col-10 text-center">
            <h2>오늘의 날씨</h2>
        </div>
    </div>

    <!-- 주소 입력 및 자동완성 -->
    <div class="row justify-content-center mb-3">
        <div class="col-10 suggestions-container">
            <input
                    type="text"
                    id="addressInput"
                    name="address"
                    class="form-control form-control-lg border-dark bg-white text-dark"
                    placeholder="주소를 입력하세요"
                    autocomplete="off"
                    required
            >
            <div id="suggestions" class="list-group"></div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-10">
            <button type="submit" class="btn btn-dark btn-lg w-100">
                검색
            </button>
        </div>
    </div>
</form>

<!-- 오류 모달 -->
<div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="resultModalLabel">알림</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
            </div>
            <div class="modal-body"><!-- 오류 메시지 --></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
